<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Training</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container" id="mainView">
        <div class="header">
            <h1>Daily Training Data</h1>
            <p style="font-size: 1.6em; margin: -5px 0 5px 0;">ðŸš€</p>
            <p>Analyze horse performance data with interactive sorting and filtering</p>
        </div>


        <div class="controls">
            <div class="control-group">
                <select id="viewSelector" onchange="switchView()">
                    <option value="active">Active Horses</option>
                    <option value="historic">Historic</option>
                </select>
            </div>

            <div class="controls-divider"></div>

            <label for="arioneoFileInput" class="file-label">Upload CSV</label>
            <input type="file" id="arioneoFileInput" accept=".csv,.xlsx" style="display: none;">

            <button onclick="openRaceUploadModal()" class="race-upload-btn">Upload Races</button>

            <button onclick="showHorseManagement()" class="btn">Manage Horses</button>
            <button onclick="clearAllData()" class="btn">Clear</button>

            <div class="controls-divider"></div>

            <div class="control-group">
                <input type="text" id="horseFilter" list="horseList" placeholder="Search horse...">
                <datalist id="horseList"></datalist>
            </div>

            <div class="control-group">
                <select id="ownerFilter" onchange="applyFilters()">
                    <option value="">All Owners</option>
                </select>
            </div>

            <div class="control-group">
                <select id="countryFilter" onchange="applyFilters()">
                    <option value="">All Countries</option>
                </select>
            </div>

            <div class="control-group">
                <select id="ageFilter">
                    <option value="">All Ages</option>
                </select>
            </div>

            <button id="exportCsv" class="btn" disabled>Export</button>
        </div>

        <div class="table-container">
            <table id="horseTable">
                <thead>
                    <tr>
                        <th onclick="sortTable('name')" class="horse-name-col">Horse <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('owner')">Owner <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('country')">Country <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('lastTrainingDate')" class="last-work-col">Last Training <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('age')" class="age-col">Age <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('best1f')">1F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('best5f')">5F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('fastRecovery')" class="fast-recovery-col">Fast <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortTable('recovery15min')" class="recovery15-col">15 min <span class="sort-indicator">â†•</span></th>
                    </tr>
                </thead>
                <tbody id="horseTableBody">
                    <tr>
                        <td colspan="9" class="no-data">No data loaded. Please upload Arioneo CSV to get started.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Horse Detail View -->
    <div class="horse-detail-view" id="horseDetailView">
    <div class="container">
        <div class="horse-detail-header">
            <h1 id="horseDetailTitle">Horse Details</h1>
        </div>

        <div class="controls">
            <div class="control-group">
                <button class="back-button" onclick="showMainView()">Main</button>
            </div>
            
            <div class="control-group">
                <label for="horseAgeFilter">Filter by Age:</label>
                <select id="horseAgeFilter">
                    <option value="">All Ages</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="typeFilter">Filter by Type:</label>
                <select id="typeFilter">
                    <option value="all">All Entries</option>
                    <option value="work">Works Only</option>
                    <option value="race">Races Only</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="horseSortBy">Sort by:</label>
                <select id="horseSortBy">
                    <option value="date">Date</option>
                    <option value="distance">Distance</option>
                    <option value="maxSpeed">Max Speed</option>
                    <option value="avgSpeed">Avg Speed</option>
                    <option value="best1f">Best 1F</option>
                    <option value="best5f">Best 5F</option>
                    <option value="maxHR">Max HR</option>
                </select>
            </div>
            
            
            <div class="control-group">
                <button id="exportHorseCsv" class="export-btn">Export</button>
            </div>
            
            <div class="control-group">
                <button id="toggleColumnVisibility" class="export-btn">Show/Hide</button>
            </div>
        </div>
        
        <!-- Column Visibility Panel -->
        <div id="columnVisibilityPanel" class="column-visibility-panel" style="display: none;">
            <div class="column-visibility-header">
                <h3>Show/Hide & Reorder Columns</h3>
                <button id="closeColumnPanel" class="close-btn">Ã—</button>
            </div>
            <div class="column-visibility-content">
                <p style="margin-bottom: 15px; color: #666; font-size: 0.9em;">
                    Check/uncheck to show/hide columns. Use arrows to reorder them.
                </p>
                <div id="columnOrderList" class="column-order-list">
                    <!-- Dynamic column list will be populated here -->
                </div>
                <div class="column-visibility-actions">
                    <button id="selectAllColumns" class="visibility-btn">Select All</button>
                    <button id="deselectAllColumns" class="visibility-btn">Deselect All</button>
                    <button id="resetColumns" class="visibility-btn">Reset to Default</button>
                </div>
            </div>
        </div>

        <div class="table-scroll-container">
            <div class="table-container" id="horseDetailTableContainer">
                <!-- Fixed header for frozen functionality -->
                <div class="fixed-header" id="fixedHeader"></div>
                <!-- Custom scrollbar for desktop - positioned after table headers -->
                <div class="desktop-scroll-track" id="customScrollTrack">
                    <div class="desktop-scroll-thumb" id="customScrollThumb"></div>
                </div>
                <table id="horseDetailTable">
                <thead>
                    <tr>
                        <th onclick="sortHorseTable('date')">Date <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('horse')">Horse <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('type')">Type <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('track')">Track <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('surface')">Surface <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('distance')">Distance <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('avgSpeed')">Avg Speed <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('maxSpeed')">Max Speed <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best1f')">Best 1F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best2f')">Best 2F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best3f')">Best 3F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best4f')">Best 4F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best5f')">Best 5F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best6f')">Best 6F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('best7f')">Best 7F <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('maxHR')">Max HR <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('fastRecovery')">Fast Recovery <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('fastQuality')">Fast Quality <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('fastPercent')">Fast % <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('recovery15')">15 Recovery <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('quality15')">15 Quality <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('hr15Percent')">HR 15% <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('maxSL')">Max SL <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('slGallop')">SL Gallop <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('sfGallop')">SF Gallop <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('slWork')">SL Work <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('sfWork')">SF Work <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('hr2min')">HR 2 min <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('hr5min')">HR 5 min <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('symmetry')">Symmetry <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('regularity')">Regularity <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('bpm120')">120bpm <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('zone5')">Zone 5 <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('age')">Age <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('sex')">Sex <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('temp')">Temp <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('distanceCol')">Distance <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('trotHR')">Trot HR <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('walkHR')">Walk HR <span class="sort-indicator">â†•</span></th>
                        <th onclick="sortHorseTable('notes')">Notes <span class="sort-indicator">â†•</span></th>
                    </tr>
                </thead>
                <tbody id="horseDetailTableBody">
                    <tr>
                        <td colspan="38" class="no-data">No data loaded for this horse.</td>
                    </tr>
                </tbody>
            </table>
            </div>
        </div>
    </div>
    </div>


    <script src="js/app.js"></script>
    <script src="js/race-upload.js"></script>

    <div class="lost-numbers">4 8 15 16 23 42</div>
</body>
</html>
